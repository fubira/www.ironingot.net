<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[ironingot.net]]></title><description><![CDATA[minecraft server
]]></description><link>https://page-ironingot-fubira.c9.io/</link><generator>Ghost 0.7</generator><lastBuildDate>Tue, 27 Oct 2015 01:24:46 GMT</lastBuildDate><atom:link href="https://page-ironingot-fubira.c9.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Themeを変えてみた]]></title><description><![CDATA[<p>Veloxが素敵だったので変えてみた。 <br>
メニューが無くなったのでdynmapへの遷移がなくなってしまった対策は後で考える。</p>]]></description><link>https://page-ironingot-fubira.c9.io/theme/</link><guid isPermaLink="false">8a179aaf-84ed-4740-abf8-dc12aa51e188</guid><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Mon, 26 Oct 2015 02:17:32 GMT</pubDate><content:encoded><![CDATA[<p>Veloxが素敵だったので変えてみた。 <br>
メニューが無くなったのでdynmapへの遷移がなくなってしまった対策は後で考える。</p>]]></content:encoded></item><item><title><![CDATA[Now under construction]]></title><description><![CDATA[<p>勉強も兼ねて、これまでこのサイトのトップページはWordPressで作っていたのだけれども、サーバ資源的にも運用負荷的にも無駄が多いと感じていたこともあって、もっとシンプルに・楽に使えそうな環境をここのところ探していた。</p>

<ul>
<li>サーバ資源を節約したい</li>
<li>markdownで書きたい</li>
<li>更新履歴を管理したい</li>
<li>用途から考えてWordPress+MySQLは冗長(アタックされまくるのでセキュリティ的にもよろしくない。)</li>
</ul>

<p>といったあたりの観点から、最終的に
 <a href="https://ghost.org/">Ghost</a> + <a href="https://github.com/axitkhurana/buster">Buster</a> + <a href="https://pages.github.com">github-pages</a> をチョイスして作ってみたのがこのページです。</p>

<p>環境を作るにあたって幾つか問題もあったのでメモ。</p>

<h4 id="staticpage">static page</h4>

<p>Ghost上でstatic pageとして扱うと、Busterでgenerateした際に拡張子なしテキストとして吐き出されるが、github-pages上では拡張子なし=application/octet-streamとして扱われるため、html表示されずダウンロードされてしまう。</p>

<p>仕方がないのでstatic pageは使わないことにする。</p>

<h4 id="slider">slider</h4>

<p>Ghostにはスライダーなんてないので<a href="https://github.com/coderkg/bxslider_plugin">coderkg/bxslider_plugin</a> <br>
を参考に、最新の<a href="https://page-ironingot-fubira.c9.io/now-under-construction/stevenwanderski/bxslider-4">bxslider</a>を入れてみた。</p>

<p>なお一部themeはbxsliderと相性が悪いらしく、<a href="https://github.com/epistrephein/Steam">epistrephein/Steam</a> では表示位置がずれたり、読み込み状態のまま進まなかったりしていて困った。</p>

<h4 id="buster">buster</h4>

<p>pip install buster でインストールできる<a href="https://page-ironingot-fubira.c9.io/now-under-construction/axitkhurana/buster">標準のBuster</a>は少しバグがある。</p>]]></description><link>https://page-ironingot-fubira.c9.io/now-under-construction/</link><guid isPermaLink="false">f32b8059-462c-4e55-80e1-8e59c8427c3a</guid><category><![CDATA[Server]]></category><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Wed, 14 Oct 2015 17:31:28 GMT</pubDate><content:encoded><![CDATA[<p>勉強も兼ねて、これまでこのサイトのトップページはWordPressで作っていたのだけれども、サーバ資源的にも運用負荷的にも無駄が多いと感じていたこともあって、もっとシンプルに・楽に使えそうな環境をここのところ探していた。</p>

<ul>
<li>サーバ資源を節約したい</li>
<li>markdownで書きたい</li>
<li>更新履歴を管理したい</li>
<li>用途から考えてWordPress+MySQLは冗長(アタックされまくるのでセキュリティ的にもよろしくない。)</li>
</ul>

<p>といったあたりの観点から、最終的に
 <a href="https://ghost.org/">Ghost</a> + <a href="https://github.com/axitkhurana/buster">Buster</a> + <a href="https://pages.github.com">github-pages</a> をチョイスして作ってみたのがこのページです。</p>

<p>環境を作るにあたって幾つか問題もあったのでメモ。</p>

<h4 id="staticpage">static page</h4>

<p>Ghost上でstatic pageとして扱うと、Busterでgenerateした際に拡張子なしテキストとして吐き出されるが、github-pages上では拡張子なし=application/octet-streamとして扱われるため、html表示されずダウンロードされてしまう。</p>

<p>仕方がないのでstatic pageは使わないことにする。</p>

<h4 id="slider">slider</h4>

<p>Ghostにはスライダーなんてないので<a href="https://github.com/coderkg/bxslider_plugin">coderkg/bxslider_plugin</a> <br>
を参考に、最新の<a href="https://page-ironingot-fubira.c9.io/now-under-construction/stevenwanderski/bxslider-4">bxslider</a>を入れてみた。</p>

<p>なお一部themeはbxsliderと相性が悪いらしく、<a href="https://github.com/epistrephein/Steam">epistrephein/Steam</a> では表示位置がずれたり、読み込み状態のまま進まなかったりしていて困った。</p>

<h4 id="buster">buster</h4>

<p>pip install buster でインストールできる<a href="https://page-ironingot-fubira.c9.io/now-under-construction/axitkhurana/buster">標準のBuster</a>は少しバグがある。 <br>
問題点を修正済みのfork版<a href="https://github.com/alokard/buster">alokard/buster</a>を使うほうが良い。</p>

<h4 id="domain">domain</h4>

<p>minecraft servrのアドレスをironingot.netにしてる関係上、ironingot.netをgithub-pagesにつなげることが出来ないので、www.ironingot.netをgithub-pagesにつなげるようにしたうえで、ironingot.netへのhttp接続をwwwにリダイレクトするようにしてある。 <br>
ほんとはwwwとかつけたくない。もっとドメイン短くしたい。</p>

<h4 id="cloud9">cloud9</h4>

<p>超便利。</p>

<p><a href="http://c9.io"><img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/Cloud9IDE.png" alt="Cloud9IDE" title=""></a></p>]]></content:encoded></item><item><title><![CDATA[Plugins]]></title><description><![CDATA[<p><mark> メンテナンス中 </mark></p>

<h3 id="omikuji">omikuji</h3>

<ul>
<li><a href="https://github.com/fubira/Omikuji">github</a></li>
<li><a href="http://ci.codearts.jp/job/Omikuji">jenkins</a></li>
</ul>

<h3 id="nihongochat">nihongochat</h3>

<ul>
<li><a href="https://github.com/fubira/NihongoChat">github</a></li>
<li><a href="http://ci.codearts.jp/job/NihongoChat">jenkins</a></li>
</ul>]]></description><link>https://page-ironingot-fubira.c9.io/plugins/</link><guid isPermaLink="false">6c073c43-f235-413b-a68c-2f1a9e52a1f3</guid><category><![CDATA[Plugins]]></category><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Wed, 14 Oct 2015 17:28:10 GMT</pubDate><content:encoded><![CDATA[<p><mark> メンテナンス中 </mark></p>

<h3 id="omikuji">omikuji</h3>

<ul>
<li><a href="https://github.com/fubira/Omikuji">github</a></li>
<li><a href="http://ci.codearts.jp/job/Omikuji">jenkins</a></li>
</ul>

<h3 id="nihongochat">nihongochat</h3>

<ul>
<li><a href="https://github.com/fubira/NihongoChat">github</a></li>
<li><a href="http://ci.codearts.jp/job/NihongoChat">jenkins</a></li>
</ul>]]></content:encoded></item><item><title><![CDATA[Minecraft Server]]></title><description><![CDATA[<h2 id="information">Information</h2>

<p><strong>ironingot minecraft server</strong>は、主に嫌儲Minecraft部(kenmomine.biz)の避難所として運用しているサーバです。動作確認や鯖落ち時の避難にご利用ください。Worldが今後も保護される保証はありませんので、定住はお勧めできません。</p>

<p>なおルールは<a href="http://kentyo2ch.wiki.fc2.com/wiki/%E3%83%AB%E3%83%BC%E3%83%AB">嫌儲Minecraft部ルール</a>に準じます。</p>

<h2 id="features">Features</h2>

<h3 id="namaposystem">NamaPo System</h3>

<p>ログインボーナスとしてポイントを配布し、AdminShopでアイテムを購入できるような仕組みを導入しています。詳しくはナマポセンターへお越しください。</p>

<h2 id="specification">Specification</h2>

<p>Version: CraftBukkit 1.7.2 <br>
Address: ironingot.net <br>
Server: CloudCore VPS CV02 <br>
Dynmap: <a href="http://dynmap.ironingot.net/">http://dynmap.ironingot.net/</a></p>

<p>嫌儲鯖はかなりのハイスペックマシンですが、こちらは並のVPSなので特にCPU負荷に弱いです。allの目安は500を上限とし、できるだけ1箇所にMobを集めないよう注意してください。</p>]]></description><link>https://page-ironingot-fubira.c9.io/minecraft-server/</link><guid isPermaLink="false">d1a5eae7-5f56-4e9c-8c72-d843caed56c4</guid><category><![CDATA[Server]]></category><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Wed, 14 Oct 2015 17:19:30 GMT</pubDate><content:encoded><![CDATA[<h2 id="information">Information</h2>

<p><strong>ironingot minecraft server</strong>は、主に嫌儲Minecraft部(kenmomine.biz)の避難所として運用しているサーバです。動作確認や鯖落ち時の避難にご利用ください。Worldが今後も保護される保証はありませんので、定住はお勧めできません。</p>

<p>なおルールは<a href="http://kentyo2ch.wiki.fc2.com/wiki/%E3%83%AB%E3%83%BC%E3%83%AB">嫌儲Minecraft部ルール</a>に準じます。</p>

<h2 id="features">Features</h2>

<h3 id="namaposystem">NamaPo System</h3>

<p>ログインボーナスとしてポイントを配布し、AdminShopでアイテムを購入できるような仕組みを導入しています。詳しくはナマポセンターへお越しください。</p>

<h2 id="specification">Specification</h2>

<p>Version: CraftBukkit 1.7.2 <br>
Address: ironingot.net <br>
Server: CloudCore VPS CV02 <br>
Dynmap: <a href="http://dynmap.ironingot.net/">http://dynmap.ironingot.net/</a></p>

<p>嫌儲鯖はかなりのハイスペックマシンですが、こちらは並のVPSなので特にCPU負荷に弱いです。allの目安は500を上限とし、できるだけ1箇所にMobを集めないよう注意してください。</p>]]></content:encoded></item><item><title><![CDATA[Spigot 1.8.3 + Hawkeye issue]]></title><description><![CDATA[<p>鯖をCraftBukkit 1.7.2 -> Spigot 1.8.3 に変えてみたところ案の定いろいろ問題が出たけども、その中で最も危険だった問題点をメモしておく。</p>

<p>1.8.3 への移行直後、Spigot鯖とは別のネットワークに置いてあったMySQL鯖に対してHawkeyeがすごい勢いでクエリを投げはじめ、送りきれないQueueが大量に蓄積されていってサーバが非常に重くなる現象が発生、まともにゲームができなくなってしまった。</p>

<p>取り急ぎHawkeyeの接続先をSpigot鯖のローカルのMySQLに変えたのだけれども、その後しばらく運営していると、サーバの空き容量が激減していることに気づき、いろいろ調べた結果MySQLのデータベースがこんなんなっていた。</p>

<pre><code>root@nagato:/var/lib/mysql# ls -lah  
total 80G  
drwx------ 10 mysql mysql 4.0K May  7 17:47 .  
drwxr-xr-x 59 root  root  4.0K Nov  5  2014</code></pre>]]></description><link>https://page-ironingot-fubira.c9.io/spigot-1-8-3-hawkeye-issue/</link><guid isPermaLink="false">f7056d39-63db-4de5-adb7-efbf02256157</guid><category><![CDATA[Minecraft]]></category><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Fri, 08 May 2015 17:29:00 GMT</pubDate><content:encoded><![CDATA[<p>鯖をCraftBukkit 1.7.2 -> Spigot 1.8.3 に変えてみたところ案の定いろいろ問題が出たけども、その中で最も危険だった問題点をメモしておく。</p>

<p>1.8.3 への移行直後、Spigot鯖とは別のネットワークに置いてあったMySQL鯖に対してHawkeyeがすごい勢いでクエリを投げはじめ、送りきれないQueueが大量に蓄積されていってサーバが非常に重くなる現象が発生、まともにゲームができなくなってしまった。</p>

<p>取り急ぎHawkeyeの接続先をSpigot鯖のローカルのMySQLに変えたのだけれども、その後しばらく運営していると、サーバの空き容量が激減していることに気づき、いろいろ調べた結果MySQLのデータベースがこんなんなっていた。</p>

<pre><code>root@nagato:/var/lib/mysql# ls -lah  
total 80G  
drwx------ 10 mysql mysql 4.0K May  7 17:47 .  
drwxr-xr-x 59 root  root  4.0K Nov  5  2014 ..  
-rw-rw----  1 mysql mysql  80G May  9 02:11 ibdata1
...
</code></pre>

<p><strong>3日前までは合計10MBも使っていなかったようなDBが80GBだと…!?</strong></p>

<p>中身を見ようにもselectするとOutOfMemoryになってしまうような状況なので、Hawkeyeの書き込み先tableを変えて数分動かしてみたところ、秒速3500行、時速にして1260万行のデータがMySQLに送られていることが判明。</p>

<pre><code>|   25077 | 2015-05-09 01:18:37 |         1 |     28 |        1 | -127 | 61 |  211 | +263:1~1                  |
|   25078 | 2015-05-09 01:18:37 |         1 |     28 |        1 | -127 | 61 |  211 | +263:1~1                  |
|   25079 | 2015-05-09 01:18:37 |         1 |     28 |        1 | -127 | 61 |  211 | +263:1~1                  |
|   25080 | 2015-05-09 01:18:37 |         1 |     28 |        1 | -127 | 61 |  211 | +263:1~1                  |
|   25081 | 2015-05-09 01:18:37 |         1 |     28 |        1 | -127 | 61 |  211 | +263:1~1                  |
|   25082 | 2015-05-09 01:18:37 |         1 |     28 |        1 |  -84 | 56 |  187 | +17:1~1                   |
|   25083 | 2015-05-09 01:18:37 |         1 |     28 |        1 |  -84 | 56 |  187 | +17:1~1                   |
|   25084 | 2015-05-09 01:18:37 |         1 |     28 |        1 |  -84 | 56 |  187 | +17:1~1                   |
...
</code></pre>

<p>これらのデータが何を意味しているかというと、こちら。</p>

<p><img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/2015-05-09_02-27-12-1024x576.jpg" alt="ホッパー">
<img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/2015-05-09_02-27-24-1024x576.jpg" alt="中身が詰まった"></p>

<p>接続先が一杯で内容物を移動できないホッパーのchest transaction(28)が大量に記録されていたのだった。1.8になってEventの挙動が変わったのか？</p>

<p>まあホッパー内にある(=運搬するような)アイテムの情報が重要である可能性はほぼないと考えられるので、ホッパーのログをfilterしてしまうことにした。</p>

<h3 id="">対策</h3>

<p>plugins/Hawkeye/config.yml のcontainedtransaction-filter: hopperの部分をfalseに書き換える。</p>

<pre><code>containertransaction-filter:  
  chest: true
  doublechest: true
  furnace: true
  dispenser: true
  hopper: false
  dropper: true
</code></pre>

<p>結果、Hawkeyeのデータ量は15分で800行ぐらい(秒速1行以下)となりました。
めでたしめでたし。</p>

<p>そして肥大化したDBだけが残った。</p>]]></content:encoded></item><item><title><![CDATA[CraftBukkit-1.8 memo]]></title><description><![CDATA[<h2 id="bukkitcraftbukkitspigot">Bukkit/CraftBukkit/Spigot  </h2>

<p>Mojang配下の公式ではなく、Spigotチームが1.8対応を行ったBukkit/CraftBukkit。今のところ生成物は配布されていないので自力でビルドする必要がある。Java-SDK + gitの環境を整えてあれば java -jar BuildTools.jar で出来上がる。</p>

<p>公式のBukkitコミュニティで開発されたものでないため、今後どうなるかの見通しは不明。ただし公式のBukkitはそれ以上に不明。</p>

<hr>

<h4 id="">看板データの変換問題</h4>

<p>CraftBukkit 1.8より一部の内部データがJSON形式で保存されるようになっているが、1.8以前のワールドにおいて作成した看板の文字列にJSONのSyntaxが含まれていた場合、その文字が消えてしまう。 <br>
この時問題になるのが、LocketteプラグインでロックをしているワールドをCraftBukkit 1.8でロードすると、</p>

<p><strong>全てのロックチェストの看板の[ ]が消滅し、ロックが外れる</strong></p>

<p>という現象が発生する。</p>

<p><img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/2014-12-06_04-22-32.jpg" alt="ロックが機能していない状態"></p>

<p>セキュリティ強制全解除というあまりにもあんまりな現象のため回避策を探したところ、以下のようにサーバjar起動時のオプションに -DconvertLegacySign=true を追加することで、読み込んだワールドの看板データを変換処理してくれる機能が存在しているのを発見。</p>

<p><code>$ java -Xmx1024M -Xms1024M -DconvertLegacySigns=true -jar craftbukkit.jar</code></p>

<p>変換と同時に看板の内部データに変換済みのフラグを埋め込むため、2重3重に変換がかかる心配はないが、1.</p>]]></description><link>https://page-ironingot-fubira.c9.io/craftbukkit-1-8-memo/</link><guid isPermaLink="false">b31609d4-f0db-4ab4-b20a-7906b9c06229</guid><category><![CDATA[Minecraft]]></category><dc:creator><![CDATA[fubira]]></dc:creator><pubDate>Fri, 05 Dec 2014 19:49:00 GMT</pubDate><content:encoded><![CDATA[<h2 id="bukkitcraftbukkitspigot">Bukkit/CraftBukkit/Spigot  </h2>

<p>Mojang配下の公式ではなく、Spigotチームが1.8対応を行ったBukkit/CraftBukkit。今のところ生成物は配布されていないので自力でビルドする必要がある。Java-SDK + gitの環境を整えてあれば java -jar BuildTools.jar で出来上がる。</p>

<p>公式のBukkitコミュニティで開発されたものでないため、今後どうなるかの見通しは不明。ただし公式のBukkitはそれ以上に不明。</p>

<hr>

<h4 id="">看板データの変換問題</h4>

<p>CraftBukkit 1.8より一部の内部データがJSON形式で保存されるようになっているが、1.8以前のワールドにおいて作成した看板の文字列にJSONのSyntaxが含まれていた場合、その文字が消えてしまう。 <br>
この時問題になるのが、LocketteプラグインでロックをしているワールドをCraftBukkit 1.8でロードすると、</p>

<p><strong>全てのロックチェストの看板の[ ]が消滅し、ロックが外れる</strong></p>

<p>という現象が発生する。</p>

<p><img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/2014-12-06_04-22-32.jpg" alt="ロックが機能していない状態"></p>

<p>セキュリティ強制全解除というあまりにもあんまりな現象のため回避策を探したところ、以下のようにサーバjar起動時のオプションに -DconvertLegacySign=true を追加することで、読み込んだワールドの看板データを変換処理してくれる機能が存在しているのを発見。</p>

<p><code>$ java -Xmx1024M -Xms1024M -DconvertLegacySigns=true -jar craftbukkit.jar</code></p>

<p>変換と同時に看板の内部データに変換済みのフラグを埋め込むため、2重3重に変換がかかる心配はないが、1.8でこのフラグ無しですでに読み込んでしまったワールドは変換処理をせずJSON型で保存済みのため、その後 convertLegacySigns を有効にすると2重変換がかかり、下記のように看板の内容が破損する。</p>

<p><img src="https://page-ironingot-fubira.c9.io/content/images/2015/10/2014-12-06_03-40-31.jpg" alt="空行が null になり、文章行は " "="" で囲まれる"=""></p>

<p>すでに1.8で起動してしまったワールドを今後も使いたい場合、後からconvertLegacySignsを設定するのはおすすめできない。泣きながらワールド中の看板を貼り直すことになる可能性が高い。</p>

<p><strong>そんな状況に陥らないためにもバックアップを忘れずに。</strong></p>

<p>※このフラグの情報が現状出てないのは、このようにワールドを壊す危険性が高いからだと推測される。また公にしていない以上、今後仕様を変えてくる可能性も考えられる。</p>

<hr>

<p>各プラグインの対応状況</p>

<h3 id="worldeditworldguardpermissionsexessentials">WorldEdit, WorldGuard, PermissionsEx, Essentials</h3>

<p>Guavaのバージョンアップに伴って問題の出る主要プラグインをSpigotチームが独自に配布している。</p>

<h3 id="multiverse">Multiverse</h3>

<p>開発関係者が1.8でも問題ないと発言</p>

<h3 id="dynmap">Dynmap</h3>

<p>dev版が出ている</p>

<h3 id="lockette">Lockette</h3>

<p>前述の看板データ変換問題がある
現行のもので動作は問題ない</p>

<h3 id="blockhat">BlockHat</h3>

<p>現状エラーが出て動かない。
メンテも長らくされてないので今後が怪しい。</p>

<h3 id="playerheads">PlayerHeads</h3>

<p>現状動かないけどそこそこ頻繁にメンテされているのでそのうち対応されると思われる</p>

<h3 id="hawkeye">HawkEye</h3>

<p>エラーは出てないけどブロック増えてる分の挙動は不明</p>]]></content:encoded></item></channel></rss>